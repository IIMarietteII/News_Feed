<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ë‰´ìŠ¤ ê¸°ì‚¬ ì„ íƒ</title>
  <link rel="stylesheet" href="common.css">
</head>
<body>
  <h1>ğŸ—ï¸ ë‰´ìŠ¤ ê¸°ì‚¬ ì„ íƒ</h1>
  <div id="articles">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
  <button id="view-newsletter">ì„ íƒí•œ ê¸°ì‚¬ë¡œ ë‰´ìŠ¤ë ˆí„° ë³´ê¸°</button>

  <script>
    let selected = [];

  fetch('data/articles.json')
      .then(res => res.json())
      .then(data => {
        const container = document.getElementById('articles');
        container.innerHTML = '';
        data.forEach(article => {
          const id = encodeURIComponent(article.id || article.link);
          const div = document.createElement('div');
          div.innerHTML = `
            <label>
              <input type="checkbox" value="${id}">
              <strong>${article.title}</strong> â€” <em>${article.source}</em><br>
              <small>${article.published}</small>
            </label>
            <hr>
          `;
          container.appendChild(div);
        });

        container.querySelectorAll('input[type=checkbox]').forEach(input => {
          input.addEventListener('change', e => {
            if (e.target.checked) selected.push(e.target.value);
            else selected = selected.filter(id => id !== e.target.value);
          });
        });
      })
      .catch(err => {
        document.getElementById('articles').innerText = 'ê¸°ì‚¬ ë¡œë”© ì‹¤íŒ¨ ğŸ˜¢';
        console.error(err);
      });

    document.getElementById('view-newsletter').addEventListener('click', () => {
      if (selected.length === 0) {
        alert("ìµœì†Œ í•˜ë‚˜ì˜ ê¸°ì‚¬ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.");
        return;
      }
      location.href = `newsletter.html?ids=${selected.join(',')}`;
    });
  </script>
</body>
</html>
